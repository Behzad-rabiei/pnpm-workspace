name: Workspace CI

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build-workspace:
        name: Build Workspace
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup pnpm
              uses: pnpm/action-setup@v3
              with:
                  version: 10

            - name: Install dependencies
              run: pnpm install --frozen-lockfile

            - name: Build packages
              run: pnpm -r build

            - name: Run tests
              run: pnpm test

            - name: Lint
              run: pnpm lint
    biome-check:
      name: Run Biome CI
      runs-on: ubuntu-latest
      needs: build-workspace

      steps:
        - name: Checkout
          uses: actions/checkout@v4

        - name: Setup pnpm
          uses: pnpm/action-setup@v3
          with:
            version: '10'

        - name: Install dependencies
          run: pnpm install --frozen-lockfile

        - name: Setup Biome
          uses: biomejs/setup-biome@v2
          with:
            version: 'latest'

        - name: Run Biome CI
          run: biome ci .
      