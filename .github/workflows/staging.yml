# .github/workflows/staging.yaml
name: Staging ğŸ³
on:
  workflow_run:
    workflows: [Quality Gate ğŸ›¡ï¸]
    types:     [completed]
    branches:  [main]

jobs:
  build-staging:
    if: ${{ github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.pull_requests == '' }}
    uses: ./.github/workflows/_build-and-push.yaml
    with:
      ref:        ${{ github.event.workflow_run.head_sha }}
      tag-suffix: main-${{ github.event.workflow_run.head_sha }}
      push:       true
      latest:     true        # bump :latest for the branch
